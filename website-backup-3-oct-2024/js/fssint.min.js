var fssinit=function(){var e,t,n,i,a,o,r,c,s,S={width:1.2,height:1.2,depth:2,segments:8,slices:5,xRange:.3,yRange:.2,zRange:1,ambient:"#000000",diffuse:"#FFFFFF",speed:.002},l={count:4,xyScalar:1,zOffset:30,ambient:"#000000",diffuse:"#FFFFFF",speed:.0015,gravity:1200,dampening:.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:!1,draw:!1,bounds:FSS.Vector3.create(),step:FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1))},d="webgl",f="canvas",h="svg",m={renderer:f},g=Date.now(),u=FSS.Vector3.create(),F=FSS.Vector3.create(),p=document.getElementById("fss"),V=document.getElementById("fss");function b(){var e,r;for(n.remove(i),t.clear(),a=new FSS.Plane(S.width*t.width,S.height*t.height,S.segments,S.slices),o=new FSS.Material(S.ambient,S.diffuse),i=new FSS.Mesh(a,o),n.add(i),e=a.vertices.length-1;e>=0;e--)(r=a.vertices[e]).anchor=FSS.Vector3.clone(r.position),r.step=FSS.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),r.time=Math.randomInRange(0,Math.PIM2)}function v(){var e,i;for(e=n.lights.length-1;e>=0;e--)i=n.lights[e],n.remove(i);for(t.clear(),e=0;e<l.count;e++)(i=new FSS.Light(l.ambient,l.diffuse)).ambientHex=i.ambient.format(),i.diffuseHex=i.diffuse.format(),n.add(i),i.mass=Math.randomInRange(.5,1),i.velocity=FSS.Vector3.create(),i.acceleration=FSS.Vector3.create(),i.force=FSS.Vector3.create()}function x(e,n){t.setSize(e,n),FSS.Vector3.set(u,t.halfWidth,t.halfHeight),b()}function y(){e=Date.now()-g,function(){var t,i,o,r,c,s,d,f=S.depth/2;FSS.Vector3.copy(l.bounds,u),FSS.Vector3.multiplyScalar(l.bounds,l.xyScalar),FSS.Vector3.setZ(F,l.zOffset),l.autopilot&&(t=Math.sin(l.step[0]*e*l.speed),i=Math.cos(l.step[1]*e*l.speed),FSS.Vector3.set(F,l.bounds[0]*t,l.bounds[1]*i,l.zOffset));for(r=n.lights.length-1;r>=0;r--){c=n.lights[r],FSS.Vector3.setZ(c.position,l.zOffset);var h=Math.clamp(FSS.Vector3.distanceSquared(c.position,F),l.minDistance,l.maxDistance),m=l.gravity*c.mass/h;FSS.Vector3.subtractVectors(c.force,F,c.position),FSS.Vector3.normalise(c.force),FSS.Vector3.multiplyScalar(c.force,m),FSS.Vector3.set(c.acceleration),FSS.Vector3.add(c.acceleration,c.force),FSS.Vector3.add(c.velocity,c.acceleration),FSS.Vector3.multiplyScalar(c.velocity,l.dampening),FSS.Vector3.limit(c.velocity,l.minLimit,l.maxLimit),FSS.Vector3.add(c.position,c.velocity)}for(s=a.vertices.length-1;s>=0;s--)d=a.vertices[s],t=Math.sin(d.time+d.step[0]*e*S.speed),i=Math.cos(d.time+d.step[1]*e*S.speed),o=Math.sin(d.time+d.step[2]*e*S.speed),FSS.Vector3.set(d.position,S.xRange*a.segmentWidth*t,S.yRange*a.sliceHeight*i,S.zRange*f*o-f),FSS.Vector3.add(d.position,d.anchor);a.dirty=!0}(),M(),requestAnimationFrame(y)}function M(){var e,i,a,o;if(t.render(n),l.draw)for(e=n.lights.length-1;e>=0;e--)switch(i=(o=n.lights[e]).position[0],a=o.position[1],m.renderer){case f:t.context.lineWidth=.5,t.context.beginPath(),t.context.arc(i,a,10,0,Math.PIM2),t.context.strokeStyle=o.ambientHex,t.context.stroke(),t.context.beginPath(),t.context.arc(i,a,4,0,Math.PIM2),t.context.fillStyle=o.diffuseHex,t.context.fill();break;case h:i+=t.halfWidth,a=t.halfHeight-a,o.core.setAttributeNS(null,"fill",o.diffuseHex),o.core.setAttributeNS(null,"cx",i),o.core.setAttributeNS(null,"cy",a),t.element.appendChild(o.core),o.ring.setAttributeNS(null,"stroke",o.ambientHex),o.ring.setAttributeNS(null,"cx",i),o.ring.setAttributeNS(null,"cy",a),t.element.appendChild(o.ring)}}function w(e){FSS.Vector3.set(F,e.x,t.height-e.y),FSS.Vector3.subtract(F,u),l.autopilot=!l.autopilot}function R(e){FSS.Vector3.set(F,e.x,t.height-e.y),FSS.Vector3.subtract(F,u)}function I(e){x(p.offsetWidth,p.offsetHeight),M()}r=new FSS.WebGLRenderer,c=new FSS.CanvasRenderer,s=new FSS.SVGRenderer,function(e){switch(t&&V.removeChild(t.element),e){case d:t=r;break;case f:t=c;break;case h:t=s}t.setSize(p.offsetWidth,p.offsetHeight),V.appendChild(t.element)}(m.renderer),n=new FSS.Scene,b(),v(),window.addEventListener("resize",I),p.addEventListener("click",w),p.addEventListener("mousemove",R),x(p.offsetWidth,p.offsetHeight),y()};$("#fss").length&&fssinit();